{% extends 'base.html' %}
{% block content %}
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <form action="{% url 'staff_add_result_save' %}" method="post">
                    {% csrf_token %}
                    <div class="card card-primary">
                        <div class="card-header">
                            <h3 class="card-title">Natija Qo'shish</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Fan</label>
                                <select class="form-control" name="subject" id="subject">
                                    {% for subject in subjects %}
                                        <option value="{{ subject.id }}">{{ subject.subject_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>O'quv Yili</label>
                                <select class="form-control" name="session_year" id="session_year">
                                    {% for session_year in session_years %}
                                        <option value="{{ session_year.id }}">{{ session_year.session_start_year }} dan {{ session_year.session_end_year }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-primary" id="fetch_student">Talabalarni Yuklash</button>
                            </div>
                            <div class="card-footer" id="student_data"></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

{% block custom_js %}
<script>
    $(document).ready(function(){
        $("#fetch_student").click(function(){
            var subject = $("#subject").val()
            var session_year = $("#session_year").val()

            $.ajax({
                url: "{% url 'get_students' %}",
                type: 'POST',
                data: {subject: subject, session_year: session_year},
            })
            .done(function(response){
                var json_data = JSON.parse(response);
                var div_data = "<div class='form-group'><label>Talaba Ro'yxati</label><select class='form-control' name='student_list'>";
                for(key in json_data){
                    div_data += "<option value='" + json_data[key]['id'] + "'>" + json_data[key]['name'] + "</option>";
                }
                div_data += "</select></div>";
                div_data += "<div class='form-group'><div class='row'>";
                div_data += "<div class='col-lg-6'><label>Topshiriq Bahosi:</label><input type='text' name='assignment_marks' class='form-control' placeholder='Assignment Marks'></div>";
                div_data += "<div class='col-lg-6'><label>Imtihon Bahosi:</label><input type='text' name='exam_marks' class='form-control' placeholder='Exam Marks'></div>";
                div_data += "</div></div>";
                div_data += "<div class='form-group'><button id='save_attendance' class='btn btn-success btn-block' type='submit'>Natijani Saqlash</button></div>";
                $("#student_data").html(div_data);
            })
            .fail(function(){
                alert("Xatolik yuz berdi")
            });
        });
    });
</script>
{% endblock custom_js %}
{% endblock content %}